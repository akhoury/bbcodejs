(function(){this.bbcode={};"undefined"!==typeof module&&(module.exports=this.bbcode)}).call(this);
(function(){var n,g,d,c,f,a,e=[].slice;f=/[&<>"]/g;c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};a=/\b((?:([\w-]+):(\/{1,3})|www[.])(?:(?:(?:[^\s&()]|&amp;|&quot;)*(?:[^!"#$%&'()*+,.:;<=>?@\[\]^`{|}~\s]))|(?:\((?:[^\s&()]|&amp;|&quot;)*\)))+)/g;g={"--":"&ndash;","---":"&mdash;","...":"&#8230;","(c)":"&copy;","(reg)":"&reg;","(tm)":"&trade;"};d=new RegExp(function(){var a;a=[];for(n in g)a.push(n.replace(/(\.|\)|\()/g,"\\$1"));return a}().join("|"));this.bbcode.Renderer=function(){function b(){this._contexts=
[];this.options={linkify:!0}}b.prototype.context=function(a,b){var e,d,c,f;d={};f=this.options;for(e in f)c=f[e],d[e]=c;for(e in a)c=a[e],d[e]=c;this._contexts.push(this.options);this.options=d;c=b();this.options=this._contexts.pop();return c};b.prototype.escape=function(a){return a.replace(f,function(a){return c[a]})};b.prototype.linkify=function(b){return b.replace(a,function(){var a,b,c;a=1<=arguments.length?e.call(arguments,0):[];c=a[1];if((b=a[2])&&"http"!==b&&"https"!==b)return c;a=a[1];b||
(a="http://"+a);return'<a href="'+a+'" target="_blank">'+c+"</a>"})};b.prototype.strip=function(a){return a.replace(/^\s+|\s+$/g,"")};b.prototype.cosmeticReplace=function(a){return a.replace(d,function(){var a;a=(1<=arguments.length?e.call(arguments,0):[])[0];return g[a]||a})};b.prototype.htmlAttributes=function(a){var b,e;if(!a)return"";var c;c=[];for(b in a)e=a[b],c.push(""+b+'="'+e+'"');return c.join(" ")};return b}()}).call(this);
(function(){var n,g,d,c,f,a,e,b,r,s,l,h,p=[].indexOf||function(a){for(var m=0,b=this.length;m<b;m++)if(m in this&&this[m]===a)return m;return-1},q={}.hasOwnProperty,k=function(a,m){function b(){this.constructor=a}for(var e in m)q.call(m,e)&&(a[e]=m[e]);b.prototype=m.prototype;a.prototype=new b;a.__super__=m.prototype;return a};h=/\r?\n/g;this.bbcode.Tag=function(){function a(m,b){var e,c,d,f,g;this.renderer=m;null==b&&(b={});this.CLOSED_BY=[];this.DISCARD_TEXT=this.STRIP_OUTER=this.STRIP_INNER=this.SELF_CLOSE=
!1;this.name=b.name||null;this.parent=b.parent||null;this.text=b.text||"";this.parent&&this.parent.children.push(this);null==b.params&&(b.params=[]);this.params={};g=b.params;d=0;for(f=g.length;d<f;d++)c=g[d],e=c[0],(c=c[1])&&(this.params[e]=c);this.children=[]}a.prototype.getContent=function(a){var b,e,c,d,f;null==a&&(a=!1);c=[];this.text&&(b=this.renderer.escape(this.text),a||(this.renderer.options.linkify&&(b=this.renderer.linkify(b)),b=this.renderer.cosmeticReplace(b.replace(h,"<br />"))),c.push(b));
e=this.children;d=0;for(f=e.length;d<f;d++)b=e[d],a?c.push(b.toText()):this.DISCARD_TEXT&&null===b.name||c.push(b.toHTML());c=c.join("");if(!a&&this.STRIP_INNER){for(c=this.renderer.strip(c);"<br />"===c.slice(0,6);)c=c.slice(6);for(;"<br />"===c.slice(-6);)c=c.slice(0,-6);c=this.renderer.strip(c)}return c};a.prototype.toText=function(a){var b,c,e,d;null==a&&(a=!1);c=[];if(null!==this.name)if(this.params.length){var f,g;f=this.params;g=[];for(b in f)e=f[b],g.push([b,e].join("="));b=g.join(" ");this.name in
this.params?c.push("["+b+"]"):c.push("["+this.name+" "+b+"]")}else c.push("["+this.name+"]");c.push(this.getContent(!a));null!==this.name&&(d=this.name,0>p.call(this.CLOSED_BY,d))&&c.push("[/"+this.name+"]");return c.join("")};a.prototype._toHTML=function(){return this.toText(!0)};a.prototype.toHTML=function(){var a;a=this._toHTML();return"string"===typeof a?a:a.join("")};return a}();g=function(a){function b(){b.__super__.constructor.apply(this,arguments);this.STRIP_INNER=!0;this._inline="inline"===
this.params.code;this._inline||(this.STRIP_OUTER=!0)}k(b,a);b.prototype._toHTML=function(){var a;return this._inline?["<code>",this.getContent(!0),"</code>"]:(a=this.params.lang||this.params[this.name])?['<pre class="prettyprint lang-'+a+'">',this.getContent(!0),"</pre>"]:["<pre>",this.getContent(!0),"</pre>"]};return b}(this.bbcode.Tag);f=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}k(b,a);b.prototype._toHTML=function(){var a;a={src:this.renderer.strip(this.getContent(!0))};
"width"in this.params&&(a.width=this.params.width);"height"in this.params&&(a.height=this.params.height);return"<img "+this.renderer.htmlAttributes(a)+" />"};return b}(this.bbcode.Tag);l=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}k(b,a);b.prototype._toHTML=function(){var a;a=this.params.size;return isNaN(a)?this.getContent():['<span style="font-size:'+a+'px">',this.getContent(),"</span>"]};return b}(this.bbcode.Tag);d=function(a){function b(){return b.__super__.constructor.apply(this,
arguments)}k(b,a);b.prototype._toHTML=function(){var a;a=this.params.color;return null!=a?['<span style="color:'+a+'">',this.getContent(),"</span>"]:this.getContent()};return b}(this.bbcode.Tag);n=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}k(b,a);b.prototype._toHTML=function(){return['<div style="text-align:center;">',this.getContent(),"</div>"]};return b}(this.bbcode.Tag);s=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}k(b,a);b.prototype._toHTML=
function(){return['<div style="float:right;">',this.getContent(),"</div>"]};return b}(this.bbcode.Tag);c=function(a){function b(){b.__super__.constructor.apply(this,arguments);this.STRIP_OUTER=this.SELF_CLOSE=!0}k(b,a);b.prototype._toHTML=function(){return"<hr />"};return b}(this.bbcode.Tag);b=function(a){function b(){b.__super__.constructor.apply(this,arguments);this.STRIP_OUTER=this.STRIP_INNER=!0}k(b,a);b.prototype._toHTML=function(){var a;a=this.params.list;return"1"===a?["<ol>",this.getContent(),
"</ol>"]:"a"===a?['<ol style="list-style-type:lower-alpha;">',this.getContent(),"</ol>"]:"A"===a?['<ol style="list-style-type:upper-alpha;">',this.getContent(),"</ol>"]:["<ul>",this.getContent(),"</ul>"]};return b}(this.bbcode.Tag);e=function(a){function b(){b.__super__.constructor.apply(this,arguments);this.CLOSED_BY=["*","/list"];this.STRIP_INNER=!0}k(b,a);b.prototype._toHTML=function(){return["<li>",this.getContent(),"</li>"]};return b}(this.bbcode.Tag);r=function(a){function b(){b.__super__.constructor.apply(this,
arguments);this.STRIP_OUTER=this.STRIP_INNER=!0}k(b,a);b.prototype._toHTML=function(){var a,b;b=["<blockquote>",this.getContent()];if(a=this.params.quote)b.push("<small>"),b.push(a),b.push("</small>");b.push("</blockquote>");return b};return b}(this.bbcode.Tag);a=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}k(b,a);b.prototype._toHTML=function(){var a;a=this.renderer.strip(this.params[this.name]||this.getContent(!0));/javascript:/i.test(a)?a="":/:/.test(a)||(a="http://"+
a);return a?this.renderer.context({linkify:!1},function(b){return function(){return['<a href="'+a+'" target="_blank">',b.getContent(),"</a>"]}}(this)):this.getContent()};return b}(this.bbcode.Tag);this.bbcode.createSimpleTag=function(a){return function(b,c){return function(a){function e(){var a,b;e.__super__.constructor.apply(this,arguments);for(a in c)b=c[a],this[a]=b}k(e,a);e.prototype._toHTML=function(){var a;(a=this.renderer.htmlAttributes(this.params))&&(a=" "+a);return["<"+b+a+">",this.getContent(),
"</"+b+">"]};return e}(a.bbcode.Tag)}}(this);this.bbcode.BUILTIN={b:this.bbcode.createSimpleTag("strong"),i:this.bbcode.createSimpleTag("em"),u:this.bbcode.createSimpleTag("u"),s:this.bbcode.createSimpleTag("strike"),h1:this.bbcode.createSimpleTag("h1",{STRIP_OUTER:!0}),h2:this.bbcode.createSimpleTag("h2",{STRIP_OUTER:!0}),h3:this.bbcode.createSimpleTag("h3",{STRIP_OUTER:!0}),h4:this.bbcode.createSimpleTag("h4",{STRIP_OUTER:!0}),h5:this.bbcode.createSimpleTag("h5",{STRIP_OUTER:!0}),h6:this.bbcode.createSimpleTag("h6",
{STRIP_OUTER:!0}),pre:this.bbcode.createSimpleTag("pre"),table:this.bbcode.createSimpleTag("table",{DISCARD_TEXT:!0}),thead:this.bbcode.createSimpleTag("thead",{DISCARD_TEXT:!0}),tbody:this.bbcode.createSimpleTag("tbody",{DISCARD_TEXT:!0}),tr:this.bbcode.createSimpleTag("tr",{DISCARD_TEXT:!0}),th:this.bbcode.createSimpleTag("th"),td:this.bbcode.createSimpleTag("td"),code:g,img:f,hr:c,size:l,center:n,right:s,color:d,list:b,"*":e,quote:r,url:a,link:a}}).call(this);
(function(){var n,g,d,c=[].indexOf||function(c){for(var a=0,e=this.length;a<e;a++)if(a in this&&this[a]===c)return a;return-1};n=/^\s*$/;d=/(\[\/?.+?\])/;g=/^\r?\n/;this.bbcode.Parser=function(){function f(a){var e,b,d;null==a&&(a=null);this.tags={};if(a)for(b=0,d=a.length;b<d;b++)e=a[b],0<=c.call(bbcode.BUILTIN,e)&&this.registerTag(e,bbcode.BUILTIN[e]);else for(e in b=bbcode.BUILTIN,b)a=b[e],this.registerTag(e,a);this.renderer=new bbcode.Renderer}f.prototype.registerTag=function(a,c){return this.tags[a]=
c};f.prototype._parseParams=function(a){var c,b,d,f,g,h,p,q,k;d=[];if(a){g=b=[];p=[];h=" ";f=!1;q=0;for(k=a.length;q<k;q++)c=a[q],f?f=!1:g===b&&"="===c?g=p:p.length||'"'!==c?c!==h?g.push(c):(d.push([b.join("").toLowerCase(),p.join("")]),n.test(h)||(f=!0),g=b=[],p=[],h=" "):h=c;d.push([b.join("").toLowerCase(),p.join("")])}return d};f.prototype._createTextNode=function(a,c){var b;null!=(b=a.children.slice(-1)[0])&&b.STRIP_OUTER&&(c=c.replace(g,""));return new bbcode.Tag(this.renderer,{text:c,parent:a})};
f.prototype.parse=function(a){var e,b,f,g,l,h;b=g=new bbcode.Tag(this.renderer);for(h=a.split(d);h.length;)(l=h.shift(),l.match(d))?(f=this._parseParams(l.slice(1,-1)),a=f[0][0],0<=c.call(b.CLOSED_BY,a)&&(h.unshift(l),a="/"+b.name,f=[]),"/"===a[0])?(a=a.slice(1),a in this.tags)?b.name===a&&(b=b.parent):this._createTextNode(b,l):(e=this.tags[a])?(e=new e(this.renderer,{name:a,parent:b,params:f}),!e.SELF_CLOSE&&(0>c.call(e.CLOSED_BY,a)||b.name!==a)&&(b=e)):this._createTextNode(b,l):this._createTextNode(b,
l);return g};f.prototype.toHTML=function(a){return this.parse(a).toHTML()};return f}()}).call(this);
(function(){var n;n={bold:{keyCode:66,title:"Bold (Ctrl+B)",placeholder:"bold text",open:"[b]",close:"[/b]"},italic:{keyCode:73,title:"Italic (Ctrl+I)",placeholder:"italic text",open:"[i]",close:"[/i]"},center:{keyCode:69,title:"Center (Ctrl+E)",placeholder:"center text",open:"[center]",close:"[/center]"},hyperlink:{keyCode:76,title:"Hyperlink (Ctrl+L)",placeholder:"link text",open:function(){return"[url="+(prompt("Please enter the URL of your link","http://")||"link url")+"]"},close:"[/url]"},blockquote:{keyCode:190,
title:"Blockquote (Ctrl+.)",placeholder:"blockquote",open:"[quote]",close:"[/quote]"},code:{keyCode:76,title:"Code (Ctrl+K)",placeholder:'print("code sample");',open:"[code]",close:"[/code]"},image:{keyCode:71,placeholder:"image url",open:"[img]",close:"[/img]"},nlist:{keyCode:79,title:"Numbered List (Ctrl+O)",placeholder:"list item",open:function(g){var d,c,f;d=(null!=(c=g.match(/\[list=1\]/g))?c.length:void 0)||0;g=(null!=(f=g.match(/\[\/list\]/g))?f.length:void 0)||0;return d===g?"[list=1]\n\t[*]":
"\t[*]"},close:function(g){var d,c,f;d=(null!=(c=g.match(/\[list=1\]/g))?c.length:void 0)||0;g=(null!=(f=g.match(/\[\/list\]/g))?f.length:void 0)||0;if(d===g)return"\n[/list]"}},list:{keyCode:85,title:"Bulleted List (Ctrl+O)",placeholder:"list item",open:function(g){var d,c,f;d=(null!=(c=g.match(/\[list\]/g))?c.length:void 0)||0;g=(null!=(f=g.match(/\[\/list\]/g))?f.length:void 0)||0;return d===g?"[list]\n\t[*]":"\t[*]"},close:function(g){var d,c,f;d=(null!=(c=g.match(/\[list\]/g))?c.length:void 0)||
0;g=(null!=(f=g.match(/\[\/list\]/g))?f.length:void 0)||0;if(d===g)return"\n[/list]"}},heading:{keyCode:72,title:"Heading (Ctrl+H)",placeholder:"heading",open:"[h3]",close:"[/h3]",before:/\n$/,after:/^\n/},hrule:{keyCode:82,title:"Hprizontal Rule (Ctrl+R)",open:"[hr]\n",before:/\n\n$/,after:/^\n\n/}};this.bbcode.Editor=function(){function g(d,c){this.markup=null!=c?c:n;this.$=$(d);this.textarea=this.$[0];this.$.on("keydown",function(c){return function(a){var d,b,g,n,l,h,p,q,k,t,m,u,v;if(9===a.which){h=
c.getSelection();l=0;if(h.start!==h.end||a.shiftKey){b=0;q=!1;n=[];m=c.textarea.value.split("\n");k=0;for(t=m.length;k<t;k++)g=m[k],d=[b,b+=g.length+1],p=d[0],d=d[1],!q&&p<=(u=h.start)&&u<d&&(q=!0),q&&(a.shiftKey?"\t"===g[0]&&(g=g.slice(1),l--):(g="\t"+g,l++),q=!(p<=(v=h.end)&&v<=d)),n.push(g);c.setValue(n.join("\n"))}else l++,h.value[1]="\t"+h.value[1],c.setValue(h.value.join(""));0<l?h.start++:0>l&&h.start--;c.select(h.start,h.end+l)}else{if(!a.ctrlKey||a.altKey||null==c.getRule(a.which))return!0;
c.replace(a.which)}return!1}}(this))}g.prototype._escapeRe=function(d){d=d.replace(RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\|\\^|\\$)","g"),"\\$1");return new RegExp("^"+d.replace(/\d+/,"\\d+")+"$")};g.prototype.getRule=function(d){var c,f,a;a=this.markup;for(c in a)if(f=a[c],f.keyCode===d)return f};g.prototype.replace=function(d,c,f){var a,e,b;this.$.focus();b=this.getSelection();e=this.getRule(d);c=this.textarea.value;a=("function"===typeof e.open?e.open(b.value[0]):e.open)||
"";d=("function"===typeof e.close?e.close(b.value[2]):e.close)||"";if(this._escapeRe(a).test(c.slice(b.start-a.length,b.start))&&this._escapeRe(d).test(c.slice(b.end,b.end+d.length)))return f=b.start-a.length,this.setValue(c.substr(0,f)+b.value[1]+c.substr(b.end+d.length,c.length)),this.select(f,f+b.value[1].length);c=a+(f||b.value[1]||e.placeholder||"")+d;null==e.before||e.before.test(b.value[0])||(c="\n\n"+c,b.start+=2);null==e.after||e.after.test(b.value[2])||(c+="\n\n",b.end+=2);this.setValue(b.value[0]+
c+b.value[2]);return this.select(b.start+a.length,b.start+c.length-d.length)};g.prototype.setValue=function(d){var c;c=this.$.scrollTop();this.$.val(d);return this.$.scrollTop(c)};g.prototype.select=function(d,c){var f;if(null!=(null!=(f=document.selection)?f.createRange:void 0))return f=this.textarea.createTextRange(),f.collapse(!0),f.moveStart("character",d),f.moveEnd("character",c-d),f.select();this.textarea.selectionStart=d;return this.textarea.selectionEnd=c};g.prototype.getSelection=function(){var d,
c,f,a,e;e=this.textarea.value;null!=(null!=(a=document.selection)?a.createRange:void 0)?(c=document.selection,/testarea/i.test(this.textarea.tagName)?(d=c.createRange(),a=d.duplicate(),a.moveToElementText(this.textarea),a.setEndPoint("EndToEnd",d),a=a.text.length-d.text.length,c=a+d.text.length):(d=c.createRange().duplicate(),d.moveEnd("character",e.length),a=""===d.text?e.length:e.lastIndexOf(d.text),d=c.createRange().duplicate(),d.moveStart("character",-e.length),c=d.text.length+1)):(a=this.textarea.selectionStart,
c=this.textarea.selectionEnd);f=e.substring(0,a);d=e.substring(c,e.length);return{start:a,end:c,value:[f,e.substring(a,c),d]}};return g}()}).call(this);
