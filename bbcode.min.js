(function(){this.bbcode={}}).call(this);
(function(){var n,h,k,m,e,a,c=Array.prototype.slice;e=/[&<>"]/g;m={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};a=/\b((?:([\w-]+):(\/{1,3})|www[.])(?:(?:(?:[^\s&()]|&amp;|&quot;)*(?:[^!"#$%&'()*+,.:;<=>?@\[\]^`{|}~\s]))|(?:\((?:[^\s&()]|&amp;|&quot;)*\)))+)/g;h={"--":"&ndash;","---":"&mdash;","...":"&#8230;","(c)":"&copy;","(reg)":"&reg;","(tm)":"&trade;"};k=RegExp(function(){var a;a=[];for(n in h)a.push(n.replace(/(\.|\)|\()/g,"\\$1"));return a}().join("|"));this.bbcode.Renderer=function(){function b(){this._contexts=
[];this.options={linkify:!0}}b.prototype.context=function(a,b){var c,d,g,e;d={};e=this.options;for(c in e)g=e[c],d[c]=g;for(c in a)g=a[c],d[c]=g;this._contexts.push(this.options);this.options=d;g=b();this.options=this._contexts.pop();return g};b.prototype.escape=function(a){return a.replace(e,function(a){return m[a]})};b.prototype.linkify=function(b){return b.replace(a,function(){var a,b,d;a=1<=arguments.length?c.call(arguments,0):[];d=a[1];if((b=a[2])&&b!=="http"&&b!=="https")return d;a=a[1];b||
(a="http://"+a);return'<a href="'+a+'" target="_blank">'+d+"</a>"})};b.prototype.strip=function(a){return a.replace(/^\s+|\s+$/g,"")};b.prototype.cosmeticReplace=function(a){return a.replace(k,function(){var a;a=(1<=arguments.length?c.call(arguments,0):[])[0];return h[a]||a})};b.prototype.htmlAttributes=function(a){var b,c;return!a?"":function(){var d;d=[];for(b in a)c=a[b],d.push(""+b+'="'+c+'"');return d}().join(" ")};return b}()}).call(this);
(function(){var n,h,k,m,e,a,c,b,p,o,f,d,g,q=Array.prototype.indexOf||function(a){for(var j=0,b=this.length;j<b;j++)if(this[j]===a)return j;return-1},r=Object.prototype.hasOwnProperty,l=function(a,j){function b(){this.constructor=a}for(var c in j)r.call(j,c)&&(a[c]=j[c]);b.prototype=j.prototype;a.prototype=new b;a.__super__=j.prototype;return a},s=function(a,j){return function(){return a.apply(j,arguments)}};g=/\r?\n/g;this.bbcode.Tag=function(){function a(j,b){var i,c,d,e,f,g;this.renderer=j;b==null&&
(b={});this.CLOSED_BY=[];this.DISCARD_TEXT=this.STRIP_OUTER=this.STRIP_INNER=this.SELF_CLOSE=!1;this.name=b.name||null;this.parent=b.parent||null;this.text=b.text||"";this.parent&&this.parent.children.push(this);b.params==null&&(b.params=[]);this.params={};f=b.params;for(d=0,e=f.length;d<e;d++)g=f[d],i=g[0],c=g[1],c&&(this.params[i]=c);this.children=[]}a.prototype.getContent=function(a){var b,i,c,d,e;a==null&&(a=!1);c=[];this.text&&(b=this.renderer.escape(this.text),a||(this.renderer.options.linkify&&
(b=this.renderer.linkify(b)),b=this.renderer.cosmeticReplace(b.replace(g,"<br />"))),c.push(b));i=this.children;for(d=0,e=i.length;d<e;d++)b=i[d],a?c.push(b.toText()):this.DISCARD_TEXT&&b.name===null||c.push(b.toHTML());c=c.join("");if(!a&&this.STRIP_INNER){for(c=this.renderer.strip(c);c.slice(0,6)==="<br />";)c=c.slice(6);for(;c.slice(-6)==="<br />";)c=c.slice(0,-6);c=this.renderer.strip(c)}return c};a.prototype.toText=function(a){var b,c,i,d,e;a==null&&(a=!1);i=[];this.name!==null&&(this.params.length?
(c=function(){var a,c;a=this.params;c=[];for(b in a)d=a[b],c.push([b,d].join("="));return c}.call(this).join(" "),this.name in this.params?i.push("["+c+"]"):i.push("["+this.name+" "+c+"]")):i.push("["+this.name+"]"));i.push(this.getContent(!a));this.name!==null&&(e=this.name,q.call(this.CLOSED_BY,e)<0)&&i.push("[/"+this.name+"]");return i.join("")};a.prototype._toHTML=function(){return[this.toText(!0)]};a.prototype.toHTML=function(){return this._toHTML().join("")};return a}();h=function(){function a(){a.__super__.constructor.apply(this,
arguments);this.STRIP_INNER=!0;this._inline=this.params.code==="inline";if(!this._inline)this.STRIP_OUTER=!0}l(a,this.bbcode.Tag);a.prototype._toHTML=function(){var a;return this._inline?["<code>",this.getContent(!0),"</code>"]:(a=this.params.lang||this.params[this.name])?['<pre class="prettyprint lang-'+a+'">',this.getContent(!0),"</pre>"]:["<pre>",this.getContent(!0),"</pre>"]};return a}.call(this);e=function(){function a(){a.__super__.constructor.apply(this,arguments)}l(a,this.bbcode.Tag);a.prototype._toHTML=
function(){var a;a={src:this.renderer.strip(this.getContent(!0))};"width"in this.params&&(a.width=this.params.width);"height"in this.params&&(a.height=this.params.height);return["<img "+this.renderer.htmlAttributes(a)+" />"]};return a}.call(this);f=function(){function a(){a.__super__.constructor.apply(this,arguments)}l(a,this.bbcode.Tag);a.prototype._toHTML=function(){var a;a=this.params.size;return isNaN(a)?this.getContent():['<span style="font-size:'+a+'px">',this.getContent(),"</span>"]};return a}.call(this);
k=function(){function a(){a.__super__.constructor.apply(this,arguments)}l(a,this.bbcode.Tag);a.prototype._toHTML=function(){var a;a=this.params.color;return!a?this.getContent():['<span style="color:'+a+'">',this.getContent(),"</span>"]};return a}.call(this);n=function(){function a(){a.__super__.constructor.apply(this,arguments)}l(a,this.bbcode.Tag);a.prototype._toHTML=function(){return['<div style="text-align:center;">',this.getContent(),"</div>"]};return a}.call(this);o=function(){function a(){a.__super__.constructor.apply(this,
arguments)}l(a,this.bbcode.Tag);a.prototype._toHTML=function(){return['<div style="float:right;">',this.getContent(),"</div>"]};return a}.call(this);m=function(){function a(){a.__super__.constructor.apply(this,arguments);this.STRIP_OUTER=this.SELF_CLOSE=!0}l(a,this.bbcode.Tag);a.prototype._toHTML=function(){return["<hr />"]};return a}.call(this);b=function(){function a(){a.__super__.constructor.apply(this,arguments);this.STRIP_OUTER=this.STRIP_INNER=!0}l(a,this.bbcode.Tag);a.prototype._toHTML=function(){var a;
a=this.params.list;return a==="1"?["<ol>",this.getContent(),"</ol>"]:a==="a"?['<ol style="list-style-type:lower-alpha;">',this.getContent(),"</ol>"]:a==="A"?['<ol style="list-style-type:upper-alpha;">',this.getContent(),"</ol>"]:["<ul>",this.getContent(),"</ul>"]};return a}.call(this);c=function(){function a(){a.__super__.constructor.apply(this,arguments);this.CLOSED_BY=["*","/list"];this.STRIP_INNER=!0}l(a,this.bbcode.Tag);a.prototype._toHTML=function(){return["<li>",this.getContent(),"</li>"]};
return a}.call(this);p=function(){function a(){a.__super__.constructor.apply(this,arguments);this.STRIP_OUTER=this.STRIP_INNER=!0}l(a,this.bbcode.Tag);a.prototype._toHTML=function(){var a,b;b=["<blockquote>",this.getContent()];if(a=this.params.quote)b.push("<small>"),b.push(a),b.push("</small>");b.push("</blockquote>");return b};return a}.call(this);a=function(){function a(){a.__super__.constructor.apply(this,arguments)}l(a,this.bbcode.Tag);a.prototype._toHTML=function(){var a;a=this.renderer.strip(this.params[this.name]||
this.getContent(!0));/javascript:/i.test(a)?a="":/:/.test(a)||(a="http://"+a);return a?this.renderer.context({linkify:!1},s(function(){return['<a href="'+a+'" target="_blank">',this.getContent(),"</a>"]},this)):[this.getContent()]};return a}.call(this);d=function(a,b){return function(){function c(){var a,d;c.__super__.constructor.apply(this,arguments);for(a in b)d=b[a],this[a]=d}l(c,this.bbcode.Tag);c.prototype._toHTML=function(){var b;(b=this.renderer.htmlAttributes(this.params))&&(b=" "+b);return["<"+
a+b+">",this.getContent(),"</"+a+">"]};return c}.call(this)};this.bbcode.BUILTIN={b:d("strong"),i:d("em"),u:d("u"),s:d("strike"),h1:d("h1",{STRIP_OUTER:!0}),h2:d("h2",{STRIP_OUTER:!0}),h3:d("h3",{STRIP_OUTER:!0}),h4:d("h4",{STRIP_OUTER:!0}),h5:d("h5",{STRIP_OUTER:!0}),h6:d("h6",{STRIP_OUTER:!0}),pre:d("pre"),table:d("table",{DISCARD_TEXT:!0}),thead:d("thead",{DISCARD_TEXT:!0}),tbody:d("tbody",{DISCARD_TEXT:!0}),tr:d("tr",{DISCARD_TEXT:!0}),th:d("th"),td:d("td"),code:h,img:e,hr:m,size:f,center:n,right:o,
color:k,list:b,"*":c,quote:p,url:a,link:a}}).call(this);
(function(){var n,h,k,m=Array.prototype.indexOf||function(e){for(var a=0,c=this.length;a<c;a++)if(this[a]===e)return a;return-1};n=/^\s*$/;k=/(\[\/?.+?\])/;h=/^\r?\n/;this.bbcode.Parser=function(){function e(a){var c,b,e;a==null&&(a=null);this.tags={};if(a)for(b=0,e=a.length;b<e;b++)c=a[b],m.call(bbcode.BUILTIN,c)>=0&&this.registerTag(c,bbcode.BUILTIN[c]);else for(c in b=bbcode.BUILTIN,b)a=b[c],this.registerTag(c,a);this.renderer=new bbcode.Renderer}e.prototype.registerTag=function(a,c){return this.tags[a]=
c};e.prototype._parseParams=function(a){var c,b,e,o,f,d,g,h,k;e=[];if(a){f=b=[];g=[];d=" ";o=!1;for(h=0,k=a.length;h<k;h++)c=a[h],o?o=!1:f===b&&c==="="?f=g:!g.length&&c==='"'?d=c:c!==d?f.push(c):(e.push([b.join("").toLowerCase(),g.join("")]),n.test(d)||(o=!0),f=b=[],g=[],d=" ");e.push([b.join("").toLowerCase(),g.join("")])}return e};e.prototype._createTextNode=function(a,c){var b;if((b=a.children.slice(-1)[0])!=null&&b.STRIP_OUTER)c=c.replace(h,"");return new bbcode.Tag(this.renderer,{text:c,parent:a})};
e.prototype.parse=function(a){var c,b,e,h,f,d;b=h=new bbcode.Tag(this.renderer);for(d=a.split(k);d.length;)if(f=d.shift(),f.match(k))if(e=this._parseParams(f.slice(1,-1)),a=e[0][0],m.call(b.CLOSED_BY,a)>=0&&(d.unshift(f),a="/"+b.name,e=[]),a[0]==="/")if(a=a.slice(1),a in this.tags){if(b.name===a)b=b.parent}else this._createTextNode(b,f);else if(c=this.tags[a]){if(c=new c(this.renderer,{name:a,parent:b,params:e}),!c.SELF_CLOSE&&(m.call(c.CLOSED_BY,a)<0||b.name!==a))b=c}else this._createTextNode(b,
f);else this._createTextNode(b,f);return h};e.prototype.toHTML=function(a){return this.parse(a).toHTML()};return e}()}).call(this);
