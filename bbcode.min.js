(function(){this.bbcode={}}).call(this);
(function(){var j,e,c,f,d,a,g=Array.prototype.slice;d=/[&<>"]/g;f={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};a=/\b((?:([\w-]+):(\/{1,3})|www[.])(?:(?:(?:[^\s&()]|&amp;|&quot;)*(?:[^!"#$%&'()*+,.:;<=>?@\[\]^`{|}~\s]))|(?:\((?:[^\s&()]|&amp;|&quot;)*\)))+)/g;e={"--":"&ndash;","---":"&mdash;","...":"&#8230;","(c)":"&copy;","(reg)":"&reg;","(tm)":"&trade;"};c=RegExp(function(){var a;a=[];for(j in e)a.push(j.replace(/(\.|\)|\()/g,"\\$1"));return a}().join("|"));this.bbcode.Renderer=function(){function b(){this._contexts=
[];this.options={linkify:!0}}b.prototype.context=function(a,b){var g,c,d,f;c={};f=this.options;for(g in f)d=f[g],c[g]=d;for(g in a)d=a[g],c[g]=d;this._contexts.push(this.options);this.options=c;d=b();this.options=this._contexts.pop();return d};b.prototype.escape=function(a){return a.replace(d,function(a){return f[a]})};b.prototype.linkify=function(b){return b.replace(a,function(){var a,b,c;a=1<=arguments.length?g.call(arguments,0):[];c=a[1];if((b=a[2])&&"http"!==b&&"https"!==b)return c;a=a[1];b||
(a="http://"+a);return'<a href="'+a+'" target="_blank">'+c+"</a>"})};b.prototype.strip=function(a){return a.replace(/^\s+|\s+$/g,"")};b.prototype.cosmeticReplace=function(a){return a.replace(c,function(){var a;a=(1<=arguments.length?g.call(arguments,0):[])[0];return e[a]||a})};b.prototype.htmlAttributes=function(a){var b,g;if(!a)return"";var c;c=[];for(b in a)g=a[b],c.push(""+b+'="'+g+'"');return c.join(" ")};return b}()}).call(this);
(function(){var j,e,c,f,d,a,g,b,q,r,k,h,n=Array.prototype.indexOf||function(a){for(var l=0,b=this.length;l<b;l++)if(l in this&&this[l]===a)return l;return-1},m=Object.prototype.hasOwnProperty,i=function(a,l){function b(){this.constructor=a}for(var g in l)m.call(l,g)&&(a[g]=l[g]);b.prototype=l.prototype;a.prototype=new b;a.__super__=l.prototype;return a},o=this;h=/\r?\n/g;this.bbcode.Tag=function(){function a(l,b){var g,c,d,f,e;this.renderer=l;null==b&&(b={});this.CLOSED_BY=[];this.DISCARD_TEXT=this.STRIP_OUTER=
this.STRIP_INNER=this.SELF_CLOSE=!1;this.name=b.name||null;this.parent=b.parent||null;this.text=b.text||"";this.parent&&this.parent.children.push(this);null==b.params&&(b.params=[]);this.params={};e=b.params;d=0;for(f=e.length;d<f;d++)c=e[d],g=c[0],(c=c[1])&&(this.params[g]=c);this.children=[]}a.prototype.getContent=function(a){var b,g,c,d,f;null==a&&(a=!1);c=[];this.text&&(b=this.renderer.escape(this.text),a||(this.renderer.options.linkify&&(b=this.renderer.linkify(b)),b=this.renderer.cosmeticReplace(b.replace(h,
"<br />"))),c.push(b));g=this.children;d=0;for(f=g.length;d<f;d++)b=g[d],a?c.push(b.toText()):this.DISCARD_TEXT&&null===b.name||c.push(b.toHTML());c=c.join("");if(!a&&this.STRIP_INNER){for(c=this.renderer.strip(c);"<br />"===c.slice(0,6);)c=c.slice(6);for(;"<br />"===c.slice(-6);)c=c.slice(0,-6);c=this.renderer.strip(c)}return c};a.prototype.toText=function(a){var b,c,g,d;null==a&&(a=!1);c=[];if(null!==this.name)if(this.params.length){var f,e;f=this.params;e=[];for(b in f)g=f[b],e.push([b,g].join("="));
b=e.join(" ");this.name in this.params?c.push("["+b+"]"):c.push("["+this.name+" "+b+"]")}else c.push("["+this.name+"]");c.push(this.getContent(!a));null!==this.name&&(d=this.name,0>n.call(this.CLOSED_BY,d))&&c.push("[/"+this.name+"]");return c.join("")};a.prototype._toHTML=function(){return this.toText(!0)};a.prototype.toHTML=function(){var a;a=this._toHTML();return"string"===typeof a?a:a.join("")};return a}();e=function(a){function b(){b.__super__.constructor.apply(this,arguments);this.STRIP_INNER=
!0;this._inline="inline"===this.params.code;this._inline||(this.STRIP_OUTER=!0)}i(b,a);b.prototype._toHTML=function(){var a;return this._inline?["<code>",this.getContent(!0),"</code>"]:(a=this.params.lang||this.params[this.name])?['<pre class="prettyprint lang-'+a+'">',this.getContent(!0),"</pre>"]:["<pre>",this.getContent(!0),"</pre>"]};return b}(this.bbcode.Tag);d=function(a){function b(){b.__super__.constructor.apply(this,arguments)}i(b,a);b.prototype._toHTML=function(){var a;a={src:this.renderer.strip(this.getContent(!0))};
"width"in this.params&&(a.width=this.params.width);"height"in this.params&&(a.height=this.params.height);return"<img "+this.renderer.htmlAttributes(a)+" />"};return b}(this.bbcode.Tag);k=function(a){function b(){b.__super__.constructor.apply(this,arguments)}i(b,a);b.prototype._toHTML=function(){var a;a=this.params.size;return isNaN(a)?this.getContent():['<span style="font-size:'+a+'px">',this.getContent(),"</span>"]};return b}(this.bbcode.Tag);c=function(a){function b(){b.__super__.constructor.apply(this,
arguments)}i(b,a);b.prototype._toHTML=function(){var a;a=this.params.color;return null!=a?['<span style="color:'+a+'">',this.getContent(),"</span>"]:this.getContent()};return b}(this.bbcode.Tag);j=function(a){function b(){b.__super__.constructor.apply(this,arguments)}i(b,a);b.prototype._toHTML=function(){return['<div style="text-align:center;">',this.getContent(),"</div>"]};return b}(this.bbcode.Tag);r=function(a){function b(){b.__super__.constructor.apply(this,arguments)}i(b,a);b.prototype._toHTML=
function(){return['<div style="float:right;">',this.getContent(),"</div>"]};return b}(this.bbcode.Tag);f=function(a){function b(){b.__super__.constructor.apply(this,arguments);this.STRIP_OUTER=this.SELF_CLOSE=!0}i(b,a);b.prototype._toHTML=function(){return"<hr />"};return b}(this.bbcode.Tag);b=function(a){function b(){b.__super__.constructor.apply(this,arguments);this.STRIP_OUTER=this.STRIP_INNER=!0}i(b,a);b.prototype._toHTML=function(){var a;a=this.params.list;return"1"===a?["<ol>",this.getContent(),
"</ol>"]:"a"===a?['<ol style="list-style-type:lower-alpha;">',this.getContent(),"</ol>"]:"A"===a?['<ol style="list-style-type:upper-alpha;">',this.getContent(),"</ol>"]:["<ul>",this.getContent(),"</ul>"]};return b}(this.bbcode.Tag);g=function(a){function b(){b.__super__.constructor.apply(this,arguments);this.CLOSED_BY=["*","/list"];this.STRIP_INNER=!0}i(b,a);b.prototype._toHTML=function(){return["<li>",this.getContent(),"</li>"]};return b}(this.bbcode.Tag);q=function(a){function b(){b.__super__.constructor.apply(this,
arguments);this.STRIP_OUTER=this.STRIP_INNER=!0}i(b,a);b.prototype._toHTML=function(){var a,b;b=["<blockquote>",this.getContent()];if(a=this.params.quote)b.push("<small>"),b.push(a),b.push("</small>");b.push("</blockquote>");return b};return b}(this.bbcode.Tag);a=function(a){function b(){b.__super__.constructor.apply(this,arguments)}i(b,a);b.prototype._toHTML=function(){var a,b=this;a=this.renderer.strip(this.params[this.name]||this.getContent(!0));/javascript:/i.test(a)?a="":/:/.test(a)||(a="http://"+
a);return a?this.renderer.context({linkify:!1},function(){return['<a href="'+a+'" target="_blank">',b.getContent(),"</a>"]}):this.getContent()};return b}(this.bbcode.Tag);this.bbcode.createSimpleTag=function(a,b){return function(c){function g(){var a,c;g.__super__.constructor.apply(this,arguments);for(a in b)c=b[a],this[a]=c}i(g,c);g.prototype._toHTML=function(){var b;(b=this.renderer.htmlAttributes(this.params))&&(b=" "+b);return["<"+a+b+">",this.getContent(),"</"+a+">"]};return g}(o.bbcode.Tag)};
this.bbcode.BUILTIN={b:this.bbcode.createSimpleTag("strong"),i:this.bbcode.createSimpleTag("em"),u:this.bbcode.createSimpleTag("u"),s:this.bbcode.createSimpleTag("strike"),h1:this.bbcode.createSimpleTag("h1",{STRIP_OUTER:!0}),h2:this.bbcode.createSimpleTag("h2",{STRIP_OUTER:!0}),h3:this.bbcode.createSimpleTag("h3",{STRIP_OUTER:!0}),h4:this.bbcode.createSimpleTag("h4",{STRIP_OUTER:!0}),h5:this.bbcode.createSimpleTag("h5",{STRIP_OUTER:!0}),h6:this.bbcode.createSimpleTag("h6",{STRIP_OUTER:!0}),pre:this.bbcode.createSimpleTag("pre"),
table:this.bbcode.createSimpleTag("table",{DISCARD_TEXT:!0}),thead:this.bbcode.createSimpleTag("thead",{DISCARD_TEXT:!0}),tbody:this.bbcode.createSimpleTag("tbody",{DISCARD_TEXT:!0}),tr:this.bbcode.createSimpleTag("tr",{DISCARD_TEXT:!0}),th:this.bbcode.createSimpleTag("th"),td:this.bbcode.createSimpleTag("td"),code:e,img:d,hr:f,size:k,center:j,right:r,color:c,list:b,"*":g,quote:q,url:a,link:a}}).call(this);
(function(){var j,e,c,f=Array.prototype.indexOf||function(c){for(var a=0,g=this.length;a<g;a++)if(a in this&&this[a]===c)return a;return-1};j=/^\s*$/;c=/(\[\/?.+?\])/;e=/^\r?\n/;this.bbcode.Parser=function(){function d(a){var c,b,d;null==a&&(a=null);this.tags={};if(a){b=0;for(d=a.length;b<d;b++)c=a[b],0<=f.call(bbcode.BUILTIN,c)&&this.registerTag(c,bbcode.BUILTIN[c])}else for(c in b=bbcode.BUILTIN,b)a=b[c],this.registerTag(c,a);this.renderer=new bbcode.Renderer}d.prototype.registerTag=function(a,
c){return this.tags[a]=c};d.prototype._parseParams=function(a){var c,b,d,f,e,h,n,m,i;d=[];if(a){e=b=[];n=[];h=" ";f=!1;m=0;for(i=a.length;m<i;m++)c=a[m],f?f=!1:e===b&&"="===c?e=n:!n.length&&'"'===c?h=c:c!==h?e.push(c):(d.push([b.join("").toLowerCase(),n.join("")]),j.test(h)||(f=!0),e=b=[],n=[],h=" ");d.push([b.join("").toLowerCase(),n.join("")])}return d};d.prototype._createTextNode=function(a,c){var b;if(null!=(b=a.children.slice(-1)[0])&&b.STRIP_OUTER)c=c.replace(e,"");return new bbcode.Tag(this.renderer,
{text:c,parent:a})};d.prototype.parse=function(a){var d,b,e,j,k,h;b=j=new bbcode.Tag(this.renderer);for(h=a.split(c);h.length;)if(k=h.shift(),k.match(c))if(e=this._parseParams(k.slice(1,-1)),a=e[0][0],0<=f.call(b.CLOSED_BY,a)&&(h.unshift(k),a="/"+b.name,e=[]),"/"===a[0])a=a.slice(1),a in this.tags?b.name===a&&(b=b.parent):this._createTextNode(b,k);else if(d=this.tags[a]){if(d=new d(this.renderer,{name:a,parent:b,params:e}),!d.SELF_CLOSE&&(0>f.call(d.CLOSED_BY,a)||b.name!==a))b=d}else this._createTextNode(b,
k);else this._createTextNode(b,k);return j};d.prototype.toHTML=function(a){return this.parse(a).toHTML()};return d}()}).call(this);
(function(){var j;j={bold:{keyCode:66,title:"Bold (Ctrl+B)",placeholder:"bold text",open:"[b]",close:"[/b]"},italic:{keyCode:73,title:"Italic (Ctrl+I)",placeholder:"italic text",open:"[i]",close:"[/i]"},center:{keyCode:69,title:"Center (Ctrl+E)",placeholder:"center text",open:"[center]",close:"[/center]"},hyperlink:{keyCode:76,title:"Hyperlink (Ctrl+L)",placeholder:"link text",open:function(){return"[url="+(prompt("Please enter the URL of your link","http://")||"link url")+"]"},close:"[/url]"},blockquote:{keyCode:190,
title:"Blockquote (Ctrl+.)",placeholder:"blockquote",open:"[quote]",close:"[/quote]"},code:{keyCode:76,title:"Code (Ctrl+K)",placeholder:'print("code sample");',open:"[code]",close:"[/code]"},image:{keyCode:71,placeholder:"image url",open:"[img]",close:"[/img]"},nlist:{keyCode:79,title:"Numbered List (Ctrl+O)",placeholder:"list item",open:function(e){var c,f,d;c=(null!=(f=e.match(/\[list=1\]/g))?f.length:void 0)||0;e=(null!=(d=e.match(/\[\/list\]/g))?d.length:void 0)||0;return c===e?"[list=1]\n\t[*]":
"\t[*]"},close:function(e){var c,f,d;c=(null!=(f=e.match(/\[list=1\]/g))?f.length:void 0)||0;e=(null!=(d=e.match(/\[\/list\]/g))?d.length:void 0)||0;if(c===e)return"\n[/list]"}},list:{keyCode:85,title:"Bulleted List (Ctrl+O)",placeholder:"list item",open:function(e){var c,f,d;c=(null!=(f=e.match(/\[list\]/g))?f.length:void 0)||0;e=(null!=(d=e.match(/\[\/list\]/g))?d.length:void 0)||0;return c===e?"[list]\n\t[*]":"\t[*]"},close:function(e){var c,f,d;c=(null!=(f=e.match(/\[list\]/g))?f.length:void 0)||
0;e=(null!=(d=e.match(/\[\/list\]/g))?d.length:void 0)||0;if(c===e)return"\n[/list]"}},heading:{keyCode:72,title:"Heading (Ctrl+H)",placeholder:"heading",open:"[h3]",close:"[/h3]",before:/\n$/,after:/^\n/},hrule:{keyCode:82,title:"Hprizontal Rule (Ctrl+R)",open:"[hr]\n",before:/\n\n$/,after:/^\n\n/}};this.bbcode.Editor=function(){function e(c,f){var d=this;this.markup=null!=f?f:j;this.$=$(c);this.textarea=this.$[0];this.$.on("keydown",function(a){var c,b,f,e,k,h,j,m,i,o,p,l,s;if(9===a.which){h=d.getSelection();
k=0;if(h.start===h.end&&!a.shiftKey)k++,h.value[1]="\t"+h.value[1],d.setValue(h.value.join(""));else{b=0;m=!1;e=[];p=d.textarea.value.split("\n");i=0;for(o=p.length;i<o;i++){f=p[i];c=[b,b+=f.length+1];j=c[0];c=c[1];if(!m&&j<=(l=h.start)&&l<c)m=!0;m&&(a.shiftKey?"\t"===f[0]&&(f=f.slice(1),k--):(f="\t"+f,k++),m=!(j<=(s=h.end)&&s<=c));e.push(f)}d.setValue(e.join("\n"))}0<k?h.start++:0>k&&h.start--;d.select(h.start,h.end+k)}else{if(!a.ctrlKey||null==d.getRule(a.which))return!0;d.replace(a.which)}return!1})}
e.prototype._escapeRe=function(c){c=c.replace(RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\|\\^|\\$)","g"),"\\$1");return RegExp("^"+c.replace(/\d+/,"\\d+")+"$")};e.prototype.getRule=function(c){var f,d,a;a=this.markup;for(f in a)if(d=a[f],d.keyCode===c)return d};e.prototype.replace=function(c,f,d){var a,e,b;this.$.focus();b=this.getSelection();e=this.getRule(c);f=this.textarea.value;a=("function"===typeof e.open?e.open(b.value[0]):e.open)||"";c=("function"===typeof e.close?e.close(b.value[2]):
e.close)||"";if(this._escapeRe(a).test(f.slice(b.start-a.length,b.start))&&this._escapeRe(c).test(f.slice(b.end,b.end+c.length)))return d=b.start-a.length,this.setValue(f.substr(0,d)+b.value[1]+f.substr(b.end+c.length,f.length)),this.select(d,d+b.value[1].length);f=a+(d||b.value[1]||e.placeholder||"")+c;null!=e.before&&!e.before.test(b.value[0])&&(f="\n\n"+f,b.start+=2);null!=e.after&&!e.after.test(b.value[2])&&(f+="\n\n",b.end+=2);this.setValue(b.value[0]+f+b.value[2]);return this.select(b.start+
a.length,b.start+f.length-c.length)};e.prototype.setValue=function(c){var f;f=this.$.scrollTop();this.$.val(c);return this.$.scrollTop(f)};e.prototype.select=function(c,f){var d;if(null!=(null!=(d=document.selection)?d.createRange:void 0))return d=this.textarea.createTextRange(),d.collapse(!0),d.moveStart("character",c),d.moveEnd("character",f-c),d.select();this.textarea.selectionStart=c;return this.textarea.selectionEnd=f};e.prototype.getSelection=function(){var c,f,d,a,e;e=this.textarea.value;null!=
(null!=(a=document.selection)?a.createRange:void 0)?/testarea/i.test(this.textarea.tagName)?(c=(void 0).createRange(),a=c.duplicate(),a.moveToElementText(this.textarea),a.setEndPoint("EndToEnd",c),a=a.text.length-c.text.length,f=a+c.text.length):(c=(void 0).createRange().duplicate(),c.moveEnd("character",e.length),a=""===c.text?e.length:e.lastIndexOf(c.text),c=(void 0).createRange().duplicate(),c.moveStart("character",-e.length),f=c.text.length):(a=this.textarea.selectionStart,f=this.textarea.selectionEnd);
d=e.substring(0,a);c=e.substring(f,e.length);return{start:a,end:f,value:[d,e.substring(a,f),c]}};return e}()}).call(this);
