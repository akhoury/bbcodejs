(function(){this.bbcode={}}).call(this);
(function(){var n,g,l,m,d,a,c=Array.prototype.slice;d=/[&<>"]/g;m={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};a=/\b((?:([\w-]+):(\/{1,3})|www[.])(?:(?:(?:[^\s&()]|&amp;|&quot;)*(?:[^!"#$%&'()*+,.:;<=>?@\[\]^`{|}~\s]))|(?:\((?:[^\s&()]|&amp;|&quot;)*\)))+)/g;g={"--":"&ndash;","---":"&mdash;","...":"&#8230;","(c)":"&copy;","(reg)":"&reg;","(tm)":"&trade;"};l=RegExp(function(){var a;a=[];for(n in g)a.push(n.replace(/(\.|\)|\()/g,"\\$1"));return a}().join("|"));this.bbcode.Renderer=function(){function b(){this._contexts=
[];this.options={linkify:!0}}b.prototype.context=function(a,b){var c,e,h,d;e={};d=this.options;for(c in d)h=d[c],e[c]=h;for(c in a)h=a[c],e[c]=h;this._contexts.push(this.options);this.options=e;h=b();this.options=this._contexts.pop();return h};b.prototype.escape=function(a){return a.replace(d,function(a){return m[a]})};b.prototype.linkify=function(b){return b.replace(a,function(){var a,b,e;a=1<=arguments.length?c.call(arguments,0):[];e=a[1];if((b=a[2])&&b!=="http"&&b!=="https")return e;a=a[1];b||
(a="http://"+a);return'<a href="'+a+'" target="_blank">'+e+"</a>"})};b.prototype.strip=function(a){return a.replace(/^\s+|\s+$/g,"")};b.prototype.cosmeticReplace=function(a){return a.replace(l,function(){var a;a=(1<=arguments.length?c.call(arguments,0):[])[0];return g[a]||a})};b.prototype.htmlAttributes=function(a){var b,c;return!a?"":function(){var e;e=[];for(b in a)c=a[b],e.push(""+b+'="'+c+'"');return e}().join(" ")};return b}()}).call(this);
(function(){var n,g,l,m,d,a,c,b,p,o,f,e,h=Array.prototype.indexOf||function(a){for(var k=0,b=this.length;k<b;k++)if(this[k]===a)return k;return-1},r=Object.prototype.hasOwnProperty,i=function(a,k){function b(){this.constructor=a}for(var c in k)r.call(k,c)&&(a[c]=k[c]);b.prototype=k.prototype;a.prototype=new b;a.__super__=k.prototype;return a},q=function(a,k){return function(){return a.apply(k,arguments)}};e=/\r?\n/g;this.bbcode.Tag=function(){function a(k,b){var j,c,e,d,f,p;this.renderer=k;b==null&&
(b={});this.CLOSED_BY=[];this.DISCARD_TEXT=this.STRIP_OUTER=this.STRIP_INNER=this.SELF_CLOSE=!1;this.name=b.name||null;this.parent=b.parent||null;this.text=b.text||"";this.parent&&this.parent.children.push(this);b.params==null&&(b.params=[]);this.params={};f=b.params;for(e=0,d=f.length;e<d;e++)p=f[e],j=p[0],c=p[1],c&&(this.params[j]=c);this.children=[]}a.prototype.getContent=function(a){var b,j,c,d,f;a==null&&(a=!1);c=[];this.text&&(b=this.renderer.escape(this.text),a||(this.renderer.options.linkify&&
(b=this.renderer.linkify(b)),b=this.renderer.cosmeticReplace(b.replace(e,"<br />"))),c.push(b));j=this.children;for(d=0,f=j.length;d<f;d++)b=j[d],a?c.push(b.toText()):this.DISCARD_TEXT&&b.name===null||c.push(b.toHTML());c=c.join("");if(!a&&this.STRIP_INNER){for(c=this.renderer.strip(c);c.slice(0,6)==="<br />";)c=c.slice(6);for(;c.slice(-6)==="<br />";)c=c.slice(0,-6);c=this.renderer.strip(c)}return c};a.prototype.toText=function(a){var b,c,j,e,d;a==null&&(a=!1);j=[];this.name!==null&&(this.params.length?
(c=function(){var a,c;a=this.params;c=[];for(b in a)e=a[b],c.push([b,e].join("="));return c}.call(this).join(" "),this.name in this.params?j.push("["+c+"]"):j.push("["+this.name+" "+c+"]")):j.push("["+this.name+"]"));j.push(this.getContent(!a));this.name!==null&&(d=this.name,h.call(this.CLOSED_BY,d)<0)&&j.push("[/"+this.name+"]");return j.join("")};a.prototype._toHTML=function(){return this.toText(!0)};a.prototype.toHTML=function(){var a;a=this._toHTML();return typeof a==="string"?a:a.join("")};return a}();
g=function(){function a(){a.__super__.constructor.apply(this,arguments);this.STRIP_INNER=!0;this._inline=this.params.code==="inline";if(!this._inline)this.STRIP_OUTER=!0}i(a,this.bbcode.Tag);a.prototype._toHTML=function(){var a;return this._inline?["<code>",this.getContent(!0),"</code>"]:(a=this.params.lang||this.params[this.name])?['<pre class="prettyprint lang-'+a+'">',this.getContent(!0),"</pre>"]:["<pre>",this.getContent(!0),"</pre>"]};return a}.call(this);d=function(){function a(){a.__super__.constructor.apply(this,
arguments)}i(a,this.bbcode.Tag);a.prototype._toHTML=function(){var a;a={src:this.renderer.strip(this.getContent(!0))};"width"in this.params&&(a.width=this.params.width);"height"in this.params&&(a.height=this.params.height);return"<img "+this.renderer.htmlAttributes(a)+" />"};return a}.call(this);f=function(){function a(){a.__super__.constructor.apply(this,arguments)}i(a,this.bbcode.Tag);a.prototype._toHTML=function(){var a;a=this.params.size;return isNaN(a)?this.getContent():['<span style="font-size:'+
a+'px">',this.getContent(),"</span>"]};return a}.call(this);l=function(){function a(){a.__super__.constructor.apply(this,arguments)}i(a,this.bbcode.Tag);a.prototype._toHTML=function(){var a;a=this.params.color;return a!=null?['<span style="color:'+a+'">',this.getContent(),"</span>"]:this.getContent()};return a}.call(this);n=function(){function a(){a.__super__.constructor.apply(this,arguments)}i(a,this.bbcode.Tag);a.prototype._toHTML=function(){return['<div style="text-align:center;">',this.getContent(),
"</div>"]};return a}.call(this);o=function(){function a(){a.__super__.constructor.apply(this,arguments)}i(a,this.bbcode.Tag);a.prototype._toHTML=function(){return['<div style="float:right;">',this.getContent(),"</div>"]};return a}.call(this);m=function(){function a(){a.__super__.constructor.apply(this,arguments);this.STRIP_OUTER=this.SELF_CLOSE=!0}i(a,this.bbcode.Tag);a.prototype._toHTML=function(){return"<hr />"};return a}.call(this);b=function(){function a(){a.__super__.constructor.apply(this,arguments);
this.STRIP_OUTER=this.STRIP_INNER=!0}i(a,this.bbcode.Tag);a.prototype._toHTML=function(){var a;a=this.params.list;return a==="1"?["<ol>",this.getContent(),"</ol>"]:a==="a"?['<ol style="list-style-type:lower-alpha;">',this.getContent(),"</ol>"]:a==="A"?['<ol style="list-style-type:upper-alpha;">',this.getContent(),"</ol>"]:["<ul>",this.getContent(),"</ul>"]};return a}.call(this);c=function(){function a(){a.__super__.constructor.apply(this,arguments);this.CLOSED_BY=["*","/list"];this.STRIP_INNER=!0}
i(a,this.bbcode.Tag);a.prototype._toHTML=function(){return["<li>",this.getContent(),"</li>"]};return a}.call(this);p=function(){function a(){a.__super__.constructor.apply(this,arguments);this.STRIP_OUTER=this.STRIP_INNER=!0}i(a,this.bbcode.Tag);a.prototype._toHTML=function(){var a,b;b=["<blockquote>",this.getContent()];if(a=this.params.quote)b.push("<small>"),b.push(a),b.push("</small>");b.push("</blockquote>");return b};return a}.call(this);a=function(){function a(){a.__super__.constructor.apply(this,
arguments)}i(a,this.bbcode.Tag);a.prototype._toHTML=function(){var a;a=this.renderer.strip(this.params[this.name]||this.getContent(!0));/javascript:/i.test(a)?a="":/:/.test(a)||(a="http://"+a);return a?this.renderer.context({linkify:!1},q(function(){return['<a href="'+a+'" target="_blank">',this.getContent(),"</a>"]},this)):this.getContent()};return a}.call(this);this.bbcode.createSimpleTag=q(function(a,b){return function(){function c(){var a,e;c.__super__.constructor.apply(this,arguments);for(a in b)e=
b[a],this[a]=e}i(c,this.bbcode.Tag);c.prototype._toHTML=function(){var b;(b=this.renderer.htmlAttributes(this.params))&&(b=" "+b);return["<"+a+b+">",this.getContent(),"</"+a+">"]};return c}.call(this)},this);this.bbcode.BUILTIN={b:this.bbcode.createSimpleTag("strong"),i:this.bbcode.createSimpleTag("em"),u:this.bbcode.createSimpleTag("u"),s:this.bbcode.createSimpleTag("strike"),h1:this.bbcode.createSimpleTag("h1",{STRIP_OUTER:!0}),h2:this.bbcode.createSimpleTag("h2",{STRIP_OUTER:!0}),h3:this.bbcode.createSimpleTag("h3",
{STRIP_OUTER:!0}),h4:this.bbcode.createSimpleTag("h4",{STRIP_OUTER:!0}),h5:this.bbcode.createSimpleTag("h5",{STRIP_OUTER:!0}),h6:this.bbcode.createSimpleTag("h6",{STRIP_OUTER:!0}),pre:this.bbcode.createSimpleTag("pre"),table:this.bbcode.createSimpleTag("table",{DISCARD_TEXT:!0}),thead:this.bbcode.createSimpleTag("thead",{DISCARD_TEXT:!0}),tbody:this.bbcode.createSimpleTag("tbody",{DISCARD_TEXT:!0}),tr:this.bbcode.createSimpleTag("tr",{DISCARD_TEXT:!0}),th:this.bbcode.createSimpleTag("th"),td:this.bbcode.createSimpleTag("td"),
code:g,img:d,hr:m,size:f,center:n,right:o,color:l,list:b,"*":c,quote:p,url:a,link:a}}).call(this);
(function(){var n,g,l,m=Array.prototype.indexOf||function(d){for(var a=0,c=this.length;a<c;a++)if(this[a]===d)return a;return-1};n=/^\s*$/;l=/(\[\/?.+?\])/;g=/^\r?\n/;this.bbcode.Parser=function(){function d(a){var c,b,d;a==null&&(a=null);this.tags={};if(a)for(b=0,d=a.length;b<d;b++)c=a[b],m.call(bbcode.BUILTIN,c)>=0&&this.registerTag(c,bbcode.BUILTIN[c]);else for(c in b=bbcode.BUILTIN,b)a=b[c],this.registerTag(c,a);this.renderer=new bbcode.Renderer}d.prototype.registerTag=function(a,c){return this.tags[a]=
c};d.prototype._parseParams=function(a){var c,b,d,o,f,e,h,g,i;d=[];if(a){f=b=[];h=[];e=" ";o=!1;for(g=0,i=a.length;g<i;g++)c=a[g],o?o=!1:f===b&&c==="="?f=h:!h.length&&c==='"'?e=c:c!==e?f.push(c):(d.push([b.join("").toLowerCase(),h.join("")]),n.test(e)||(o=!0),f=b=[],h=[],e=" ");d.push([b.join("").toLowerCase(),h.join("")])}return d};d.prototype._createTextNode=function(a,c){var b;if((b=a.children.slice(-1)[0])!=null&&b.STRIP_OUTER)c=c.replace(g,"");return new bbcode.Tag(this.renderer,{text:c,parent:a})};
d.prototype.parse=function(a){var c,b,d,g,f,e;b=g=new bbcode.Tag(this.renderer);for(e=a.split(l);e.length;)if(f=e.shift(),f.match(l))if(d=this._parseParams(f.slice(1,-1)),a=d[0][0],m.call(b.CLOSED_BY,a)>=0&&(e.unshift(f),a="/"+b.name,d=[]),a[0]==="/")if(a=a.slice(1),a in this.tags){if(b.name===a)b=b.parent}else this._createTextNode(b,f);else if(c=this.tags[a]){if(c=new c(this.renderer,{name:a,parent:b,params:d}),!c.SELF_CLOSE&&(m.call(c.CLOSED_BY,a)<0||b.name!==a))b=c}else this._createTextNode(b,
f);else this._createTextNode(b,f);return g};d.prototype.toHTML=function(a){return this.parse(a).toHTML()};return d}()}).call(this);
