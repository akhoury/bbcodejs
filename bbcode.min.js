(function(){this.bbcode={};"undefined"!==typeof module&&(module.exports=this.bbcode)}).call(this);
(function(){var h,g,c,d,e,f,b=[].slice;e=/[&<>"]/g;d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};f=/\b((?:([\w-]+):(\/{1,3})|www[.])(?:(?:(?:[^\s&()]|&amp;|&quot;)*(?:[^!"#$%&'()*+,.:;<=>?@\[\]^`{|}~\s]))|(?:\((?:[^\s&()]|&amp;|&quot;)*\)))+)/g;g={"--":"&ndash;","---":"&mdash;","...":"&#8230;","(c)":"&copy;","(reg)":"&reg;","(tm)":"&trade;"};c=new RegExp(function(){var b;b=[];for(h in g)b.push(h.replace(/(\.|\)|\()/g,"\\$1"));return b}().join("|"));this.bbcode.Renderer=function(){function a(){this._contexts=
[];this.options={linkify:!0}}a.prototype.context=function(b,a){var d,c,e,f;c={};f=this.options;for(d in f)e=f[d],c[d]=e;for(d in b)e=b[d],c[d]=e;this._contexts.push(this.options);this.options=c;e=a();this.options=this._contexts.pop();return e};a.prototype.escape=function(b){return b.replace(e,function(b){return d[b]})};a.prototype.linkify=function(a){return a.replace(f,function(){var a,d,c;a=1<=arguments.length?b.call(arguments,0):[];c=a[1];if((d=a[2])&&"http"!==d&&"https"!==d)return c;a=a[1];d||
(a="http://"+a);return'<a href="'+a+'" target="_blank">'+c+"</a>"})};a.prototype.strip=function(b){return b.replace(/^\s+|\s+$/g,"")};a.prototype.cosmeticReplace=function(a){return a.replace(c,function(){var a;a=(1<=arguments.length?b.call(arguments,0):[])[0];return g[a]||a})};a.prototype.htmlAttributes=function(b){var a,d;if(!b)return"";var c;c=[];for(a in b)d=b[a],c.push(""+a+'="'+d+'"');return c.join(" ")};return a}()}).call(this);
(function(){var h,g,c,d,e,f,b,a,q,t,n,k,p=[].indexOf||function(b){for(var a=0,d=this.length;a<d;a++)if(a in this&&this[a]===b)return a;return-1},m={}.hasOwnProperty,l=function(a,b){function d(){this.constructor=a}for(var c in b)m.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype;a.prototype=new d;a.__super__=b.prototype;return a};k=/\r?\n/g;this.bbcode.Tag=function(){function a(b,d){var c,e,f,q,g;this.renderer=b;null==d&&(d={});this.CLOSED_BY=[];this.DISCARD_TEXT=this.STRIP_OUTER=this.STRIP_INNER=this.SELF_CLOSE=
!1;this.name=d.name||null;this.parent=d.parent||null;this.text=d.text||"";this.parent&&this.parent.children.push(this);null==d.params&&(d.params=[]);this.params={};g=d.params;f=0;for(q=g.length;f<q;f++)e=g[f],c=e[0],(e=e[1])&&(this.params[c]=e);this.children=[]}a.prototype.getContent=function(a){var b,d,c,e,f;null==a&&(a=!1);c=[];this.text&&(b=this.renderer.escape(this.text),a||(this.renderer.options.linkify&&(b=this.renderer.linkify(b)),b=this.renderer.cosmeticReplace(b.replace(k,"<br />"))),c.push(b));
d=this.children;e=0;for(f=d.length;e<f;e++)b=d[e],a?c.push(b.toText()):this.DISCARD_TEXT&&null===b.name||c.push(b.toHTML());c=c.join("");if(!a&&this.STRIP_INNER){for(c=this.renderer.strip(c);"<br />"===c.slice(0,6);)c=c.slice(6);for(;"<br />"===c.slice(-6);)c=c.slice(0,-6);c=this.renderer.strip(c)}return c};a.prototype.toText=function(a){var b,c,d,e;null==a&&(a=!1);c=[];if(null!==this.name)if(this.params.length){var f,q;f=this.params;q=[];for(b in f)d=f[b],q.push([b,d].join("="));b=q.join(" ");this.name in
this.params?c.push("["+b+"]"):c.push("["+this.name+" "+b+"]")}else c.push("["+this.name+"]");c.push(this.getContent(!a));null!==this.name&&(e=this.name,0>p.call(this.CLOSED_BY,e))&&c.push("[/"+this.name+"]");return c.join("")};a.prototype._toHTML=function(){return this.toText(!0)};a.prototype.toHTML=function(){var b;b=this._toHTML();return"string"===typeof b?b:b.join("")};return a}();g=function(b){function a(){a.__super__.constructor.apply(this,arguments);this.STRIP_INNER=!0;this._inline="inline"===
this.params.code;this._inline||(this.STRIP_OUTER=!0)}l(a,b);a.prototype._toHTML=function(){var b;return this._inline?["<code>",this.getContent(!0),"</code>"]:(b=this.params.lang||this.params[this.name])?['<pre class="prettyprint lang-'+b+'">',this.getContent(!0),"</pre>"]:["<pre>",this.getContent(!0),"</pre>"]};return a}(this.bbcode.Tag);e=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,b);a.prototype._toHTML=function(){var b;b={src:this.renderer.strip(this.getContent(!0))};
"width"in this.params&&(b.width=this.params.width);"height"in this.params&&(b.height=this.params.height);return"<img "+this.renderer.htmlAttributes(b)+" />"};return a}(this.bbcode.Tag);n=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,b);a.prototype._toHTML=function(){var b;b=this.params.size;return isNaN(b)?this.getContent():['<span style="font-size:'+b+'px">',this.getContent(),"</span>"]};return a}(this.bbcode.Tag);c=function(b){function a(){return a.__super__.constructor.apply(this,
arguments)}l(a,b);a.prototype._toHTML=function(){var b;b=this.params.color;return null!=b?['<span style="color:'+b+'">',this.getContent(),"</span>"]:this.getContent()};return a}(this.bbcode.Tag);h=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,b);a.prototype._toHTML=function(){return['<div style="text-align:center;">',this.getContent(),"</div>"]};return a}(this.bbcode.Tag);t=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,b);a.prototype._toHTML=
function(){return['<div style="float:right;">',this.getContent(),"</div>"]};return a}(this.bbcode.Tag);d=function(b){function a(){a.__super__.constructor.apply(this,arguments);this.STRIP_OUTER=this.SELF_CLOSE=!0}l(a,b);a.prototype._toHTML=function(){return"<hr />"};return a}(this.bbcode.Tag);a=function(b){function a(){a.__super__.constructor.apply(this,arguments);this.STRIP_OUTER=this.STRIP_INNER=!0}l(a,b);a.prototype._toHTML=function(){var a;a=this.params.list;return"1"===a?["<ol>",this.getContent(),
"</ol>"]:"a"===a?['<ol style="list-style-type:lower-alpha;">',this.getContent(),"</ol>"]:"A"===a?['<ol style="list-style-type:upper-alpha;">',this.getContent(),"</ol>"]:["<ul>",this.getContent(),"</ul>"]};return a}(this.bbcode.Tag);b=function(a){function b(){b.__super__.constructor.apply(this,arguments);this.CLOSED_BY=["*","/list"];this.STRIP_INNER=!0}l(b,a);b.prototype._toHTML=function(){return["<li>",this.getContent(),"</li>"]};return b}(this.bbcode.Tag);q=function(a){function b(){b.__super__.constructor.apply(this,
arguments);this.STRIP_OUTER=this.STRIP_INNER=!0}l(b,a);b.prototype._toHTML=function(){var a,b;b=["<blockquote>",this.getContent()];if(a=this.params.quote)b.push("<small>"),b.push(a),b.push("</small>");b.push("</blockquote>");return b};return b}(this.bbcode.Tag);f=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}l(a,b);a.prototype._toHTML=function(){var a;a=this.renderer.strip(this.params[this.name]||this.getContent(!0));/javascript:/i.test(a)?a="":/:/.test(a)||(a="http://"+
a);return a?this.renderer.context({linkify:!1},function(b){return function(){return['<a href="'+a+'" target="_blank">',b.getContent(),"</a>"]}}(this)):this.getContent()};return a}(this.bbcode.Tag);this.bbcode.createSimpleTag=function(a){return function(b,c){return function(a){function d(){var a,b;d.__super__.constructor.apply(this,arguments);for(a in c)b=c[a],this[a]=b}l(d,a);d.prototype._toHTML=function(){var a;(a=this.renderer.htmlAttributes(this.params))&&(a=" "+a);return["<"+b+a+">",this.getContent(),
"</"+b+">"]};return d}(a.bbcode.Tag)}}(this);this.bbcode.BUILTIN={b:this.bbcode.createSimpleTag("strong"),i:this.bbcode.createSimpleTag("em"),u:this.bbcode.createSimpleTag("u"),s:this.bbcode.createSimpleTag("strike"),h1:this.bbcode.createSimpleTag("h1",{STRIP_OUTER:!0}),h2:this.bbcode.createSimpleTag("h2",{STRIP_OUTER:!0}),h3:this.bbcode.createSimpleTag("h3",{STRIP_OUTER:!0}),h4:this.bbcode.createSimpleTag("h4",{STRIP_OUTER:!0}),h5:this.bbcode.createSimpleTag("h5",{STRIP_OUTER:!0}),h6:this.bbcode.createSimpleTag("h6",
{STRIP_OUTER:!0}),pre:this.bbcode.createSimpleTag("pre"),table:this.bbcode.createSimpleTag("table",{DISCARD_TEXT:!0}),thead:this.bbcode.createSimpleTag("thead",{DISCARD_TEXT:!0}),tbody:this.bbcode.createSimpleTag("tbody",{DISCARD_TEXT:!0}),tr:this.bbcode.createSimpleTag("tr",{DISCARD_TEXT:!0}),th:this.bbcode.createSimpleTag("th"),td:this.bbcode.createSimpleTag("td"),code:g,img:e,hr:d,size:n,center:h,right:t,color:c,list:a,"*":b,quote:q,url:f,link:f}}).call(this);
(function(){var h,g,c,d,e=[].indexOf||function(c){for(var b=0,a=this.length;b<a;b++)if(b in this&&this[b]===c)return b;return-1};g=/^\s*$/;d=/(\[\/?.+?\])/;c=/^\r?\n/;h=this.bbcode;this.bbcode.Parser=function(){function f(b){var a,c,d;null==b&&(b=null);this.tags={};if(b)for(c=0,d=b.length;c<d;c++)a=b[c],0<=e.call(h.BUILTIN,a)&&this.registerTag(a,h.BUILTIN[a]);else for(a in c=h.BUILTIN,c)b=c[a],this.registerTag(a,b);this.renderer=new h.Renderer}f.prototype.registerTag=function(b,a){return this.tags[b]=
a};f.prototype._parseParams=function(b){var a,c,d,e,f,h,m,l,r;d=[];if(b){f=c=[];m=[];h=" ";e=!1;l=0;for(r=b.length;l<r;l++)a=b[l],e?e=!1:f===c&&"="===a?f=m:m.length||'"'!==a?a!==h?f.push(a):(d.push([c.join("").toLowerCase(),m.join("")]),g.test(h)||(e=!0),f=c=[],m=[],h=" "):h=a;d.push([c.join("").toLowerCase(),m.join("")])}return d};f.prototype._createTextNode=function(b,a){var d;null!=(d=b.children.slice(-1)[0])&&d.STRIP_OUTER&&(a=a.replace(c,""));return new h.Tag(this.renderer,{text:a,parent:b})};
f.prototype.parse=function(b){var a,c,f,g,k,p;c=g=new h.Tag(this.renderer);for(p=b.split(d);p.length;)(k=p.shift(),k.match(d))?(f=this._parseParams(k.slice(1,-1)),b=f[0][0],0<=e.call(c.CLOSED_BY,b)&&(p.unshift(k),b="/"+c.name,f=[]),"/"===b[0])?(b=b.slice(1),b in this.tags)?c.name===b&&(c=c.parent):this._createTextNode(c,k):(a=this.tags[b])?(a=new a(this.renderer,{name:b,parent:c,params:f}),!a.SELF_CLOSE&&(0>e.call(a.CLOSED_BY,b)||c.name!==b)&&(c=a)):this._createTextNode(c,k):this._createTextNode(c,
k);return g};f.prototype.toHTML=function(b){return this.parse(b).toHTML()};return f}()}).call(this);
(function(){var h;h={bold:{keyCode:66,title:"Bold (Ctrl+B)",placeholder:"bold text",open:"[b]",close:"[/b]"},italic:{keyCode:73,title:"Italic (Ctrl+I)",placeholder:"italic text",open:"[i]",close:"[/i]"},center:{keyCode:69,title:"Center (Ctrl+E)",placeholder:"center text",open:"[center]",close:"[/center]"},hyperlink:{keyCode:76,title:"Hyperlink (Ctrl+L)",placeholder:"link text",open:function(){return"[url="+(prompt("Please enter the URL of your link","http://")||"link url")+"]"},close:"[/url]"},blockquote:{keyCode:190,
title:"Blockquote (Ctrl+.)",placeholder:"blockquote",open:"[quote]",close:"[/quote]"},code:{keyCode:76,title:"Code (Ctrl+K)",placeholder:'print("code sample");',open:"[code]",close:"[/code]"},image:{keyCode:71,placeholder:"image url",open:"[img]",close:"[/img]"},nlist:{keyCode:79,title:"Numbered List (Ctrl+O)",placeholder:"list item",open:function(g){var c,d,e;c=(null!=(d=g.match(/\[list=1\]/g))?d.length:void 0)||0;g=(null!=(e=g.match(/\[\/list\]/g))?e.length:void 0)||0;return c===g?"[list=1]\n\t[*]":
"\t[*]"},close:function(g){var c,d,e;c=(null!=(d=g.match(/\[list=1\]/g))?d.length:void 0)||0;g=(null!=(e=g.match(/\[\/list\]/g))?e.length:void 0)||0;if(c===g)return"\n[/list]"}},list:{keyCode:85,title:"Bulleted List (Ctrl+O)",placeholder:"list item",open:function(g){var c,d,e;c=(null!=(d=g.match(/\[list\]/g))?d.length:void 0)||0;g=(null!=(e=g.match(/\[\/list\]/g))?e.length:void 0)||0;return c===g?"[list]\n\t[*]":"\t[*]"},close:function(g){var c,d,e;c=(null!=(d=g.match(/\[list\]/g))?d.length:void 0)||
0;g=(null!=(e=g.match(/\[\/list\]/g))?e.length:void 0)||0;if(c===g)return"\n[/list]"}},heading:{keyCode:72,title:"Heading (Ctrl+H)",placeholder:"heading",open:"[h3]",close:"[/h3]",before:/\n$/,after:/^\n/},hrule:{keyCode:82,title:"Hprizontal Rule (Ctrl+R)",open:"[hr]\n",before:/\n\n$/,after:/^\n\n/}};this.bbcode.Editor=function(){function g(c,d){this.markup=null!=d?d:h;this.$=$(c);this.textarea=this.$[0];this.$.on("keydown",function(c){return function(d){var b,a,g,h,n,k,p,m,l,r,s,u,v;if(9===d.which){k=
c.getSelection();n=0;if(k.start!==k.end||d.shiftKey){a=0;m=!1;h=[];s=c.textarea.value.split("\n");l=0;for(r=s.length;l<r;l++)g=s[l],b=[a,a+=g.length+1],p=b[0],b=b[1],!m&&p<=(u=k.start)&&u<b&&(m=!0),m&&(d.shiftKey?"\t"===g[0]&&(g=g.slice(1),n--):(g="\t"+g,n++),m=!(p<=(v=k.end)&&v<=b)),h.push(g);c.setValue(h.join("\n"))}else n++,k.value[1]="\t"+k.value[1],c.setValue(k.value.join(""));0<n?k.start++:0>n&&k.start--;c.select(k.start,k.end+n)}else{if(!d.ctrlKey||d.altKey||null==c.getRule(d.which))return!0;
c.replace(d.which)}return!1}}(this))}g.prototype._escapeRe=function(c){c=c.replace(RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\|\\^|\\$)","g"),"\\$1");return new RegExp("^"+c.replace(/\d+/,"\\d+")+"$")};g.prototype.getRule=function(c){var d,e,f;f=this.markup;for(d in f)if(e=f[d],e.keyCode===c)return e};g.prototype.replace=function(c,d,e){var f,b,a;this.$.focus();a=this.getSelection();b=this.getRule(c);d=this.textarea.value;f=("function"===typeof b.open?b.open(a.value[0]):b.open)||
"";c=("function"===typeof b.close?b.close(a.value[2]):b.close)||"";if(this._escapeRe(f).test(d.slice(a.start-f.length,a.start))&&this._escapeRe(c).test(d.slice(a.end,a.end+c.length)))return e=a.start-f.length,this.setValue(d.substr(0,e)+a.value[1]+d.substr(a.end+c.length,d.length)),this.select(e,e+a.value[1].length);d=f+(e||a.value[1]||b.placeholder||"")+c;null==b.before||b.before.test(a.value[0])||(d="\n\n"+d,a.start+=2);null==b.after||b.after.test(a.value[2])||(d+="\n\n",a.end+=2);this.setValue(a.value[0]+
d+a.value[2]);return this.select(a.start+f.length,a.start+d.length-c.length)};g.prototype.setValue=function(c){var d;d=this.$.scrollTop();this.$.val(c);return this.$.scrollTop(d)};g.prototype.select=function(c,d){var e;if(null!=(null!=(e=document.selection)?e.createRange:void 0))return e=this.textarea.createTextRange(),e.collapse(!0),e.moveStart("character",c),e.moveEnd("character",d-c),e.select();this.textarea.selectionStart=c;return this.textarea.selectionEnd=d};g.prototype.getSelection=function(){var c,
d,e,f,b;b=this.textarea.value;null!=(null!=(f=document.selection)?f.createRange:void 0)?(d=document.selection,/testarea/i.test(this.textarea.tagName)?(c=d.createRange(),f=c.duplicate(),f.moveToElementText(this.textarea),f.setEndPoint("EndToEnd",c),f=f.text.length-c.text.length,d=f+c.text.length):(c=d.createRange().duplicate(),c.moveEnd("character",b.length),f=""===c.text?b.length:b.lastIndexOf(c.text),c=d.createRange().duplicate(),c.moveStart("character",-b.length),d=c.text.length+1)):(f=this.textarea.selectionStart,
d=this.textarea.selectionEnd);e=b.substring(0,f);c=b.substring(d,b.length);return{start:f,end:d,value:[e,b.substring(f,d),c]}};return g}()}).call(this);
